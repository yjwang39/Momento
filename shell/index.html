<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Shell &middot; Momento
    
  </title>

  
  <link rel="stylesheet" href="../css/poole.css">
  <link rel="stylesheet" href="../css/syntax.css">
  <link rel="stylesheet" href="../css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="./fa/css/font-awesome.min.css">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../favicon/android-icon-144x144.png">
  <link rel="shortcut icon" href="../favicon.ico">

</head>


  <body class="theme-base-0d">

  
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A place to gather useful information I keep on forgetting.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="../">Home</a>
    <a class="sidebar-nav-item " href="../post">Posts</a>
    <a class="sidebar-nav-item " href="https://yjwang39.github.io/momento/fixed/python/">Python</a>
      <a class="sidebar-nav-item " href="https://yjwang39.github.io/momento/latex/">LaTeX</a>
      <a class="sidebar-nav-item  active " href="https://yjwang39.github.io/momento/shell/">Shell</a>
      <a class="sidebar-nav-item " href="https://yjwang39.github.io/momento/markdown/">Markdown</a>
      <a class="sidebar-nav-item " href="https://yjwang39.github.io/momento/fixed/tools/">Tools</a>
      <a class="sidebar-nav-item " href="https://yjwang39.github.io/momento/about/">About</a>
      
    <a class="sidebar-nav-item" href="https://github.com/yjwang39/momento">GitHub project</a>
    </nav>

  <div class="sidebar-item">
  </div>

  <div class="sidebar-item">
    <p>&copy; 2020 Yujuan Wang. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="../" title="Home">Momento</a>
            <small>some quick reference</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="page">
  <h1 class="page-title">Shell</h1>
  <small><em class="page-description">Common configuration, useful command and so on...</em></small>
  <p>This page focuses on configuration of the terminal, useful commands and scripting.<br />
Command-line tools I used (e.g. git) are described in the <a href="../tools/">Tools page</a>.</p>
<ul>
<li><a href="#external-links">External links</a></li>
<li><a href="#regular-expression">Regular Expression</a></li>
<li><a href="#linux-command">Linux Command</a>
<ul>
<li><a href="#rename---renaming-multiple-files"><code>rename</code> - renaming multiple files</a></li>
<li><a href="#grep---grep-as-globally-search-for-re-and-print-it"><code>grep</code> - <code>g/RE/p</code> as globally search for RE and print it</a></li>
</ul>
</li>
<li><a href="#ssh-login">SSH login</a>
<ul>
<li><a href="#configuring-passwordless-authentication">Configuring Passwordless Authentication</a></li>
</ul>
</li>
</ul>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="https://github.com/jlevy/the-art-of-command-line">The Art of Command Line</a></li>
<li><a href="https://terminalsare.sexy/">Terminals Are Sexy</a></li>
</ul>
<h2 id="regular-expression">Regular Expression</h2>
<ul>
<li><code>grey|gray</code> is an equivalent pattern of <code>gr(a|e)y</code></li>
<li>Quantification
<ol>
<li><code>?</code> - zero/one occurrences</li>
<li><code>*</code> - zero/more occurrences</li>
<li><code>+</code> - one/more occurrences</li>
<li><code>{n}</code> - exactly <em>n</em> times</li>
</ol>
</li>
<li><code>^[a-z0-9_-]{3,15}$</code> - 3 to 15 characters containing lowercase letters, numbers or &ldquo;_&rdquo; &ldquo;-&rdquo;.</li>
<li><code>[^a-z]</code> - any single character that is not lowercase letter.</li>
<li><code>\s</code> - whitespace characters</li>
<li><code>\S</code> - the opposite of <code>\s</code> = <code>[^ \t\n\r\f\v]</code></li>
<li><code>\w</code> = <code>[a-zA-Z0-9_]</code></li>
</ul>
<h2 id="linux-command">Linux Command</h2>
<h3 id="rename---renaming-multiple-files"><code>rename</code> - renaming multiple files</h3>
<p><code>mv</code> (short of <em>move</em>) command is used to rename or move files from one location to another.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mv <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="nb">source</span> destination
<span class="c1"># renaming multiple files - rename all .html files extension to .php</span>
<span class="k">for</span> f in *.html<span class="p">;</span> <span class="k">do</span>
    mv -- <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">f</span><span class="p">%.html</span><span class="si">}</span><span class="s2">.php&#34;</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><p>Use <code>rename</code> to make it one-line case!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">rename <span class="o">[</span>options<span class="o">]</span> <span class="s2">&#34;s/oldname/newname/&#34;</span> file
</code></pre></td></tr></table>
</div>
</div><p>However, I have to remind you that <code>man rename</code> works far more efficient than this.</p>
<h3 id="grep---grep-as-globally-search-for-re-and-print-it"><code>grep</code> - <code>g/RE/p</code> as globally search for RE and print it</h3>
<p><code>grep</code> is an acronym that stands for <strong>G</strong>lobal <strong>R</strong>egular <strong>E</strong>xpression <strong>P</strong>rint. It is used to search for a string of characters in a specified file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">grep string file1 file2
grep <span class="s2">&#34;text&#34;</span> . -r -n
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>-i</code> - ignore case</li>
<li><code>-w</code> - whole words only</li>
<li><code>-v</code> - inverse search - <strong>do not</strong> match</li>
<li><code>-x</code> - show lines</li>
<li><code>-l</code> - list names of matching files</li>
<li><code>-c</code> - count the number of matches</li>
<li><code>-A/B/C 3</code> - display 3 lines before/after/before&amp;after the match</li>
</ul>
<p>Use this with <code>ls</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">ls <span class="p">|</span> grep <span class="s2">&#34;^[a-f]&#34;</span>
ls <span class="p">|</span> grep <span class="s2">&#34;[g-h]</span>$<span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ssh-login">SSH login</h2>
<p>I would like it simple when I have to log in remote servers using terminal shell:</p>
<ul>
<li><em>do not</em> have to remember all the various remote addresses and usernames.</li>
<li>enable X11 forwarding and SSH agent forwarding, which allows running graphical applications remotely</li>
<li><em>do not</em> have to enter various passwords for different servers.</li>
</ul>
<p>The solution is to edit <code>~/.ssh/config</code>(<em>user-specific configuration file</em>) or <code>/ect/ssh/ssh_config</code>(<em>global configuration file</em>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># for all ssh connection</span>
Host *
    ForwardAgent yes
    ForwardX11 yes
    ForwardX11Trusted yes
    XauthLocation /opt/X11/bin/xauth 
    PubkeyAuthentication yes
    AddKeysToAgent yes <span class="c1">#authentication</span>
    UseKeychain yes
    IdentityFile ~/.ssh/id_rsa
<span class="c1"># example course server</span>
Host course1
  HostName course.example.com
  User student
  Port <span class="m">22</span>
  IdentitiesOnly yes

Host group
  HostName group.nju.edu.cn
  User me
  Port <span class="m">22</span>
</code></pre></td></tr></table>
</div>
</div><p>Now I can log in the server by identifiers that I set, e.g. <code>ssh group</code>.</p>
<h3 id="configuring-passwordless-authentication">Configuring Passwordless Authentication</h3>
<table>
<thead>
<tr>
<th align="center"><img src="../images/ssh_login.png" alt="How does this work?" title="SSH Authentication" /></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>How does this work?</em></td>
</tr>
</tbody>
</table>
<ol>
<li>First, make sure that you have <code>id_rsa</code> and <code>id_rsa.pub</code> public/private keypairs in the directory <code>~/.ssh/</code>, or you can generate <code>rsa</code> key by</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">ssh-keygen -t rsa
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Second, copy the public key <code>id_rsa.pub</code> from ssh client to server <code>~/.ssh/authorized_keys</code>. Using <code>scp</code> command could be tedious, so we use <code>ssh-copy-id</code> command.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">ssh-copy-id -i ~/.ssh/id_rsa.pub username@server -p <span class="m">22</span>
</code></pre></td></tr></table>
</div>
</div><p>Then you are prompted to enter the password or complete other authentication for the server. Note that the private key should never be copied to another machine.</p>
<ol start="3">
<li>Change the permission of authorized key file to 600</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">chmod -f <span class="m">600</span> ~/.ssh/authorized_keys
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>Then you can test the new key.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">ssh -v username@server
</code></pre></td></tr></table>
</div>
</div><p>The login should now complete without asking for a password. If the test fails, read the output to see what it says about whether the key is tried and what authentication methods the server is willing to accept.</p>
<p>Note that the command might ask for the <strong>passphrase</strong> you specified for the keypairs. You can easily add/remove passphrase of your keypairs by using the following command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">ssh-keygen -p
</code></pre></td></tr></table>
</div>
</div><ol>
<li>On the first prompt, enter the file path (or press Enter to use the default)</li>
<li>Second prompt, enter the old passphrase</li>
<li>Next prompt, just press enter to unset the passphrase</li>
</ol>
<p><em>Note: I still failed and after googling around, I found trying the following could help.</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#Change the permision of user directory</span>
chmod <span class="m">700</span> /home/username
<span class="c1">#.Change the permision of .ssh directory</span>
chmod <span class="m">700</span> ~/.ssh/
</code></pre></td></tr></table>
</div>
</div>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
  </body>
</html>

